(window.webpackJsonp=window.webpackJsonp||[]).push([[98],{444:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"opentsdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#opentsdb"}},[t._v("#")]),t._v(" OpenTSDB")]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("h3",{attrs:{id:"安装hbase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装hbase"}},[t._v("#")]),t._v(" 安装HBase")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://mirror.bit.edu.cn/apache/hbase/stable/hbase-2.2.4-bin.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf hbase-2.2.4-bin.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("echo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$JAVA_HOME")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" hbase-2.2.4\n./bin/start-hbase.sh \njps "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("HMaster"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问：http://localhost:16010/")]),t._v("\n./bin/stop-hbase.sh\n")])])]),a("h3",{attrs:{id:"访问hbase"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#访问hbase"}},[t._v("#")]),t._v(" 访问HBase")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("./bin/hbase shell\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":001:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("help")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":004:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" create "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cf'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":005:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" list "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":006:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" describe "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":007:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" put "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'row1'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cf:a'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'value1'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":008:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" put "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'row2'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cf:b'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'value2'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":009:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" put "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'row3'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'cf:c'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'value3'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":010:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" scan "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":011:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" get "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'row1'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":012:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" disable "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":013:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("enable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":014:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" disable "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":015:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" drop "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'test'")]),t._v("\nhbase"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(":016:"),a("span",{pre:!0,attrs:{class:"token operator"}},[a("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[t._v("0")]),t._v(">")]),t._v(" quit\n")])])]),a("h3",{attrs:{id:"安装zookeeper"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装zookeeper"}},[t._v("#")]),t._v(" 安装Zookeeper")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.6.1/apache-zookeeper-3.6.1-bin.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" xf apache-zookeeper-3.6.1-bin.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("cd")]),t._v(" apache-zookeeper-3.6.1-bin\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("vim")]),t._v(" conf/zoo.cfg\n\t"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("tickTime")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000")]),t._v("\n\t"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("dataDir")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/var/lib/zookeeper\n\t"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("clientPort")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\nbin/zkServer.sh start\ntelnet localhost "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2181")]),t._v("\n")])])]),a("h3",{attrs:{id:"安装opentsdb"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装opentsdb"}},[t._v("#")]),t._v(" 安装OpenTSDB")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" https://github.com/OpenTSDB/opentsdb/releases/download/v2.4.0/opentsdb-2.4.0.noarch.rpm\nyum "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("install")]),t._v(" opentsdb-2.4.0.noarch.rpm -y\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# HBase建表")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("env")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("COMPRESSION")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("NONE "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("HBASE_HOME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("./hbase-2.2.4 /usr/share/opentsdb/tools/create_table.sh \n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置文件")]),t._v("\n/etc/opentsdb/opentsdb.conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tsd.http.cachedir - Path to write temporary files to")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tsd.http.staticroot - Path to the static GUI files found in ./build/staticroot")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# tsd.storage.hbase.zk_quorum - If HBase and Zookeeper are not running on the same machine, specify the host and port here.")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 启动")]),t._v("\ntsdb tsd\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 访问GUI")]),t._v("\nhttp://127.0.0.1:4242\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 清理临时文件（tsd.http.cachedir）")]),t._v("\ntools/clean_cache.sh.\n")])])]),a("h2",{attrs:{id:"向tsd写数据"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#向tsd写数据"}},[t._v("#")]),t._v(" 向TSD写数据")]),t._v(" "),a("h3",{attrs:{id:"name-schema-命名格式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#name-schema-命名格式"}},[t._v("#")]),t._v(" name schema  命名格式")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("metric name")]),t._v(" "),a("p",[t._v("指标名 如 sys.cpu.user")])]),t._v(" "),a("li",[a("p",[t._v("tag")]),t._v(" "),a("p",[t._v("标签 如 host=webserver01,cpu=0 用于定位具体的time series")]),t._v(" "),a("p",[t._v("every time series in opentsdb must have at least one tag")])])]),t._v(" "),a("p",[t._v("time series由 metric name 和 tag 组合定义，查询格式如下：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ${aggregation}:${metric name}{$tag1, $tag2}")]),t._v("\nsum:sys.cpu.user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("webserver01,cpu"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nsum:sys.cpu.user\n"),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("start")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("1d-ago"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("m")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("avg:sys.cpu.user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("host"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("webserver01"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"limited-unique-ids-uids-uid限制"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#limited-unique-ids-uids-uid限制"}},[t._v("#")]),t._v(" Limited Unique IDs(UIDs)  UID限制")]),t._v(" "),a("p",[t._v("opentsdb会为每一个metric name,tag name(tagk),tag value(tagv)分配一个ID好，默认有1600万个可分配的ID，如果用完了数据就无法写入了。")]),t._v(" "),a("p",[t._v("当创建一个新的TSDB时我们可以设置UID的宽度：")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("tsd.storage.uid.width.metric\ntsd.storage.uid.width.tagk\ntsd.storage.uid.width.tagv\n")])])]),a("h3",{attrs:{id:"data-specification-数据字段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#data-specification-数据字段"}},[t._v("#")]),t._v(" Data Specification 数据字段")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("metric, timestamp, value, tags\n")])])]),a("h3",{attrs:{id:"添加自动创建metric-tag配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#添加自动创建metric-tag配置"}},[t._v("#")]),t._v(" 添加自动创建metric,tag配置")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("tsd.core.auto_create_metrics "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 下面两个默认为true")]),t._v("\ntsd.core.auto_create_tagks "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\ntsd.core.auto_create_tagvs "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n")])])]),a("h3",{attrs:{id:"telnet"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#telnet"}},[t._v("#")]),t._v(" Telnet")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("put sys.cpu.user "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1356998400")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("42.5")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("host")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("webserver01 "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("cpu")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\n")])])]),a("h3",{attrs:{id:"http-api"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http-api"}},[t._v("#")]),t._v(" HTTP API")]),t._v(" "),a("div",{staticClass:"language-http extra-class"},[a("pre",{pre:!0,attrs:{class:"language-http"}},[a("code",[t._v('POST http://192.168.4.128:4242/api/put?summary\n\n[\n\t{\n\t\t"metric": "sys.cpu.user",\n\t\t"timestamp": 1591268344069,\n\t\t"value": 42.5,\n\t\t"tags": {\n\t\t\t"host": "webserver01",\n\t\t\t"cpu": "0"\n\t\t}\n\t}\n]\n')])])]),a("h3",{attrs:{id:"tcollector-工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tcollector-工具"}},[t._v("#")]),t._v(" tcollector 工具")]),t._v(" "),a("h2",{attrs:{id:"tsdb-命令行工具"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#tsdb-命令行工具"}},[t._v("#")]),t._v(" tsdb 命令行工具")])])}),[],!1,null,null,null);s.default=n.exports}}]);